{"version":3,"file":"builder.js","sourceRoot":"","sources":["../../src/record/builder.ts"],"names":[],"mappings":";;;AAEA,mDAAoD;AAI7C,MAAM,eAAe,GAAG,CAAC,IAAiB,EAAE,EAAE,CAAC,CACpD,UAAuB,EACvB,EAAE;IACF,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;IAE7B,OAAO,UAAU;SACd,GAAG,CAAC,CAAC,SAAS,EAAE,EAAE;QACjB,SAAS,CAAC,UAAU,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;QAC7C,MAAM,QAAQ,GAAG,SAAS,CAAC,UAAU,EAAE,CAAC;QACxC,MAAM,SAAS,GAAG,QAAQ,CAAC,KAAK,EAAE,CAAC;QACnC,OAAO,SAAS,CAAC;IACnB,CAAC,CAAC;SACD,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC;AACvB,CAAC,CAAC;AAbW,QAAA,eAAe,mBAa1B;AAEK,MAAM,eAAe,GAAG,CAAC,IAAiB,EAAE,EAAE,CAAC,CACpD,SAAoB,EACpB,oBAA4B,EAC5B,EAAE;IACF,OAAO,SAAS,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE;QAC3B,MAAM,SAAS,GAAG,IAAI,yBAAa,CACjC;YACE,WAAW,EAAE,GAAG,CAAC,IAAI;YACrB,eAAe,EAAE,IAAI,CAAC,OAAO;YAC7B,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,cAAc,EAAE,oBAAoB;YACpC,UAAU,EAAE,GAAG,CAAC,QAAQ,CAAC,MAAM;SAChC,EACD,GAAG,CAAC,QAAQ,CACb,CAAC;QACF,OAAO,SAAS,CAAC;IACnB,CAAC,CAAC,CAAC;AACL,CAAC,CAAC;AAjBW,QAAA,eAAe,mBAiB1B","sourcesContent":["import { DtlsContext } from \"../context/dtls\";\nimport { Handshake } from \"../typings/domain\";\nimport { DtlsPlaintext } from \"./message/plaintext\";\n\nexport type Message = { type: number; fragment: Buffer };\n\nexport const createFragments = (dtls: DtlsContext) => (\n  handshakes: Handshake[]\n) => {\n  dtls.lastFlight = handshakes;\n\n  return handshakes\n    .map((handshake) => {\n      handshake.messageSeq = dtls.sequenceNumber++;\n      const fragment = handshake.toFragment();\n      const fragments = fragment.chunk();\n      return fragments;\n    })\n    .flatMap((v) => v);\n};\n\nexport const createPlaintext = (dtls: DtlsContext) => (\n  fragments: Message[],\n  recordSequenceNumber: number\n) => {\n  return fragments.map((msg) => {\n    const plaintext = new DtlsPlaintext(\n      {\n        contentType: msg.type,\n        protocolVersion: dtls.version,\n        epoch: dtls.epoch,\n        sequenceNumber: recordSequenceNumber,\n        contentLen: msg.fragment.length,\n      },\n      msg.fragment\n    );\n    return plaintext;\n  });\n};\n"]}